# CursorToolset æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£æè¿° CursorToolset çš„æµ‹è¯•æµç¨‹å’Œè§„èŒƒã€‚

## æµ‹è¯•åŸåˆ™

> **é‡è¦**: å‘½ä»¤æ‰§è¡ŒæˆåŠŸ â‰  æµ‹è¯•é€šè¿‡

æ¯ä¸ªæµ‹è¯•å¿…é¡»æœ‰æ˜ç¡®çš„éªŒè¯æ¡ä»¶ï¼š
1. å‘½ä»¤å¿…é¡»æˆåŠŸæ‰§è¡Œï¼ˆexit code = 0ï¼‰
2. è¾“å‡ºå¿…é¡»ç¬¦åˆé¢„æœŸ
3. **å…³é”®æ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”å†…å®¹æ­£ç¡®**

ä¾‹å¦‚ï¼Œ`install` å‘½ä»¤ä¸ä»…è¦æˆåŠŸï¼Œè¿˜è¦éªŒè¯ï¼š
- åŒ…ç›®å½•å­˜åœ¨
- `package.json` å­˜åœ¨
- äºŒè¿›åˆ¶æ–‡ä»¶å­˜åœ¨ï¼ˆå¦‚æœæœ‰ï¼‰
- `.cursortoolset/docs/package-dev-guide.md` å­˜åœ¨

## æµ‹è¯•ç±»å‹

| ç±»å‹ | å‘½ä»¤/è§¦å‘ | è¯´æ˜ |
|------|-----------|------|
| å•å…ƒæµ‹è¯• | `make test` | Go å•å…ƒæµ‹è¯• |
| åŠŸèƒ½æµ‹è¯• | `./scripts/run-tests.sh` | å®Œæ•´åŠŸèƒ½éªŒè¯ |
| å®šæ—¶æµ‹è¯• | GitHub Actions (æ¯å¤© 8:00 åŒ—äº¬æ—¶é—´) | è‡ªåŠ¨åŒ–å›å½’æµ‹è¯• |
| æ‰‹åŠ¨æµ‹è¯• | è§ä¸‹æ–‡ | æŒ‰æ­¥éª¤æ‰‹åŠ¨éªŒè¯ |

## CI å®šæ—¶æµ‹è¯•

### è§¦å‘æ¡ä»¶

- **å®šæ—¶è§¦å‘**: åŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š 8:00 (UTC 0:00)
- **å˜æ›´æ£€æŸ¥**: ä»…å½“ main åˆ†æ”¯åœ¨è¿‡å» 24 å°æ—¶æœ‰æ–°æäº¤æ—¶è¿è¡Œ
- **æ‰‹åŠ¨è§¦å‘**: æ”¯æŒåœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è¿è¡Œ

### æµ‹è¯•å†…å®¹

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| å•å…ƒæµ‹è¯• | `go test ./... -v -cover` |
| ä»£ç æ£€æŸ¥ | golangci-lint |
| åŠŸèƒ½æµ‹è¯• | `./scripts/run-tests.sh` |
| è·¨å¹³å°æ„å»º | linux/darwin/windows Ã— amd64/arm64 |

### æ‰‹åŠ¨è§¦å‘

1. è®¿é—® [GitHub Actions](https://github.com/shichao402/CursorToolset/actions/workflows/scheduled-test.yml)
2. ç‚¹å‡» "Run workflow"
3. å¯é€‰æ‹© "è·³è¿‡å˜æ›´æ£€æŸ¥" å¼ºåˆ¶è¿è¡Œ

## æµ‹è¯•ç¯å¢ƒ

### æµ‹è¯•åŒ…ä»“åº“

- **åœ°å€**: https://github.com/shichao402/cursortoolset-test-package
- **ç”¨é€”**: ä¸“é—¨ç”¨äºéªŒè¯åŒ…ç®¡ç†å™¨åŠŸèƒ½
- **ç‰¹ç‚¹**: åŒ…å« Go ç¨‹åºï¼Œè¾“å‡ºç¼–è¯‘æ—¶é—´ï¼ŒéªŒè¯äºŒè¿›åˆ¶ç¼–è¯‘

### å‰ç½®æ¡ä»¶

```bash
# å¿…éœ€
go version        # Go 1.21+
jq --version      # JSON å¤„ç†
curl --version    # HTTP è¯·æ±‚

# å¯é€‰
strings --help    # äºŒè¿›åˆ¶åˆ†æï¼ˆéªŒè¯ç¼–è¯‘æ—¶é—´ï¼‰
```

## å¿«é€Ÿæµ‹è¯•

### è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

```bash
cd /path/to/CursorToolset
./scripts/run-tests.sh
```

**é¢„æœŸè¾“å‡º**:
```
==========================================
CursorToolset å®Œæ•´åŠŸèƒ½æµ‹è¯•
==========================================
...
æµ‹è¯•ç»“æœç»Ÿè®¡
==========================================
é€šè¿‡: 16
å¤±è´¥: 0

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

## æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½

| # | åŠŸèƒ½ | å‘½ä»¤ | éªŒè¯ç‚¹ |
|---|------|------|--------|
| 1 | æ¸…ç†æ‰€æœ‰ | `clean --all --force` | `cache/packages/` å’Œ `repos/` è¢«æ¸…ç† |
| 2 | æ›´æ–°ç´¢å¼• | `registry update` | `config/registry.json` å­˜åœ¨ä¸”æœ‰æ•ˆ |
| 3 | åˆ—å‡ºåŒ… | `list` | è¾“å‡ºåŒ…å« test-package |
| 4 | æœç´¢åŒ… | `search <keyword>` | æ‰¾åˆ°åŒ¹é…çš„åŒ… |
| 5 | æŸ¥çœ‹è¯¦æƒ… | `info <package>` | æ˜¾ç¤ºç‰ˆæœ¬ç­‰å®Œæ•´ä¿¡æ¯ |
| 6 | å®‰è£…åŒ… | `install <package>` | åŒ…ç›®å½•å®Œæ•´ï¼ˆå« package-dev-guide.mdï¼‰ |
| 7 | å·²å®‰è£…åˆ—è¡¨ | `list --installed` | æ˜¾ç¤ºå·²å®‰è£…çš„åŒ… |
| 8 | **ç¼–è¯‘æ—¶é—´éªŒè¯** | `strings` | äºŒè¿›åˆ¶åŒ…å«ç¼–è¯‘æ—¶é—´æˆ³ |
| 9 | æ›´æ–°åŒ… | `update --packages` | æ£€æµ‹å¹¶æ›´æ–° |
| 10 | å¸è½½åŒ… | `uninstall <package>` | åŒ…ç›®å½•è¢«åˆ é™¤ |
| 11 | ç¡®è®¤å¸è½½ | `list --installed` | åˆ—è¡¨ä¸ºç©º |
| 12 | å®‰è£…æ‰€æœ‰ | `install` | æ‰¹é‡å®‰è£…æˆåŠŸ |
| 13 | æ¸…ç†ç¼“å­˜ | `clean --cache` | `cache/packages/` è¢«æ¸…ç† |
| 14 | åˆå§‹åŒ–é¡¹ç›® | `init <name>` | ç”Ÿæˆå®Œæ•´æ–‡ä»¶ç»“æ„ |
| 15 | å¼ºåˆ¶åˆå§‹åŒ– | `init --force` | è¡¥å……ç¼ºå¤±æ–‡ä»¶ |
| 16 | ç‰ˆæœ¬æ˜¾ç¤º | `version` | æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬ |

### å…³é”®éªŒè¯ç‚¹è¯´æ˜

**æµ‹è¯• 06 (install) çš„éªŒè¯é¡¹**:
```
âœ“ åŒ…ç›®å½•å®Œæ•´
âœ“ package.json å­˜åœ¨
âœ“ äºŒè¿›åˆ¶æ–‡ä»¶å­˜åœ¨
âœ“ .cursortoolset ç›®å½•å­˜åœ¨
âœ“ package-dev-guide.md å­˜åœ¨  â† å…³é”®ï¼ç¡®ä¿æ–‡æ¡£è¢«æ­£ç¡®åˆ†å‘
```

**æµ‹è¯• 14 (init) çš„éªŒè¯é¡¹**:
```
âœ“ package.json å­˜åœ¨ä¸”æœ‰æ•ˆ
âœ“ README.md å­˜åœ¨
âœ“ .cursortoolset/docs/package-dev-guide.md å­˜åœ¨
âœ“ .github/workflows/release.yml å­˜åœ¨
âœ“ .gitignore å­˜åœ¨
```

## æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### 1. æ„å»ºç®¡ç†å™¨

```bash
cd /path/to/CursorToolset
go build -o cursortoolset .
./cursortoolset --version
```

### 2. æ¸…ç†ç¯å¢ƒ

```bash
./cursortoolset clean --all --force
```

### 3. æ›´æ–°åŒ…ç´¢å¼•

```bash
./cursortoolset registry update
```

### 4. å®‰è£…æµ‹è¯•åŒ…

```bash
./cursortoolset install test-package
```

### 5. éªŒè¯ç¼–è¯‘æ—¶é—´ â­

è¿™æ˜¯æœ€å…³é”®çš„éªŒè¯ï¼Œç¡®ä¿ GitHub Actions æ­£ç¡®ç¼–è¯‘äº†äºŒè¿›åˆ¶ï¼š

```bash
# æå–ç¼–è¯‘æ—¶é—´
strings ~/.cursortoolsets/repos/test-package/test-package | grep -E '^20[0-9]{2}-[0-9]{2}-[0-9]{2}_[0-9]{2}:[0-9]{2}:[0-9]{2}$'
```

**é¢„æœŸ**: æ˜¾ç¤º UTC æ—¶é—´æ ¼å¼çš„ç¼–è¯‘æ—¶é—´ï¼Œå¦‚ `2025-12-06_13:40:57`

### 6. æœ¬åœ°ç¼–è¯‘éªŒè¯

```bash
cd ~/.cursortoolsets/repos/test-package
go build -ldflags "-X main.Version=local -X 'main.BuildTime=$(date '+%Y-%m-%d_%H:%M:%S')'" -o test-package-local .
./test-package-local
```

**é¢„æœŸè¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    CursorToolset Test Package              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ç‰ˆæœ¬: local
  ç¼–è¯‘æ—¶é—´: 2025-12-06_21:47:12
  Go ç‰ˆæœ¬: go1.x.x
  ç³»ç»Ÿ: darwin/arm64

âœ… å¦‚æœä½ çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œè¯´æ˜äºŒè¿›åˆ¶æ–‡ä»¶å·²æˆåŠŸç¼–è¯‘å¹¶è¿è¡Œï¼
```

### 7. æµ‹è¯• init å‘½ä»¤

```bash
cd /tmp
rm -rf test-init-pkg
cursortoolset init test-init-pkg
ls -la test-init-pkg/
```

**é¢„æœŸæ–‡ä»¶ç»“æ„**:
```
test-init-pkg/
â”œâ”€â”€ .cursortoolset/
â”‚   â””â”€â”€ docs/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## æµ‹è¯•æ£€æŸ¥æ¸…å•

æ¯æ¬¡ä¿®æ”¹åï¼Œç¡®ä¿ä»¥ä¸‹æµ‹è¯•é€šè¿‡ï¼š

- [ ] `make lint` æ— é”™è¯¯
- [ ] `make test` å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] `./scripts/run-tests.sh` åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ç¼–è¯‘æ—¶é—´éªŒè¯é€šè¿‡

## æ›´æ–°æµ‹è¯•åŒ…

å½“éœ€è¦æ›´æ–°æµ‹è¯•åŒ…æ—¶ï¼š

```bash
cd /path/to/cursortoolset-test-package

# ä¿®æ”¹ä»£ç 
# ...

# æäº¤
git add -A
git commit -m "feat: æ›´æ–°"

# å‘å¸ƒ
git tag v0.x.x
git push origin main
git push origin v0.x.x
```

GitHub Actions ä¼šè‡ªåŠ¨æ„å»ºå¹¶åˆ›å»º Releaseã€‚

## å¸¸è§é—®é¢˜

### Q: äºŒè¿›åˆ¶æ–‡ä»¶æ— æ³•è¿è¡Œï¼Ÿ

GitHub Actions é»˜è®¤ç¼–è¯‘ Linux x86-64 ç‰ˆæœ¬ã€‚åœ¨ macOS ä¸Šï¼š
- ä½¿ç”¨ `strings` å‘½ä»¤éªŒè¯ç¼–è¯‘æ—¶é—´
- æˆ–æœ¬åœ°é‡æ–°ç¼–è¯‘è¿è¡Œ

### Q: SHA256 æ ¡éªŒå¤±è´¥ï¼Ÿ

ç¡®ä¿ Release ä¸­çš„ `package.json` æ˜¯ç”± workflow è‡ªåŠ¨ç”Ÿæˆçš„ã€‚

### Q: æµ‹è¯•è„šæœ¬æŠ¥é”™ï¼Ÿ

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. è¿è¡Œ `cursortoolset registry update`
3. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯

### Q: æµ‹è¯•é€šè¿‡ä½†åŠŸèƒ½æœ‰é—®é¢˜ï¼Ÿ

æ£€æŸ¥éªŒè¯å‡½æ•°æ˜¯å¦è¶³å¤Ÿä¸¥æ ¼ã€‚ä¾‹å¦‚ï¼š
- `install` åä¸ä»…è¦æ£€æŸ¥ç›®å½•å­˜åœ¨ï¼Œè¿˜è¦æ£€æŸ¥å…³é”®æ–‡ä»¶
- `clean` åè¦æ£€æŸ¥æ­£ç¡®çš„ç›®å½•è¢«æ¸…ç†

## ç»´æŠ¤æµ‹è¯•è„šæœ¬

### æ·»åŠ æ–°éªŒè¯

å½“å‘ç°æµ‹è¯•é—æ¼æ—¶ï¼Œåœ¨ `scripts/run-tests.sh` ä¸­æ·»åŠ éªŒè¯å‡½æ•°ï¼š

```bash
# éªŒè¯å‡½æ•°æ¨¡æ¿
verify_xxx() {
    # 1. æ£€æŸ¥æ–‡ä»¶/ç›®å½•å­˜åœ¨
    if [ ! -f "$expected_file" ]; then
        echo "  âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨: $expected_file"
        return 1
    fi
    
    # 2. æ£€æŸ¥å†…å®¹æ­£ç¡®
    if ! grep -q "expected_content" "$file"; then
        echo "  âš ï¸  å†…å®¹ä¸ç¬¦åˆé¢„æœŸ"
        return 1
    fi
    
    echo "  âœ“ éªŒè¯é€šè¿‡"
    return 0
}
```

### ç›®å½•ç»“æ„è¯´æ˜

```
~/.cursortoolsets/
â”œâ”€â”€ repos/              # å·²å®‰è£…çš„åŒ…ï¼ˆclean --all æ¸…ç†ï¼‰
â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ packages/       # ä¸‹è½½çš„ tarballï¼ˆclean --cache æ¸…ç†ï¼‰
â”‚   â””â”€â”€ manifests/      # åŒ…ä¿¡æ¯ç¼“å­˜ï¼ˆregistry update ç®¡ç†ï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ registry.json   # æœ¬åœ°ç´¢å¼•
â”œâ”€â”€ bin/                # å¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥
â””â”€â”€ docs/               # å…¬å¼€æ–‡æ¡£
```

## ç›¸å…³æ–‡æ¡£

- [å¼€å‘æŒ‡å—](DEVELOPMENT.md)
- [æ„å»ºå®‰è£…æŒ‡å—](BUILD.md)
